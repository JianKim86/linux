# chapter02 리눅스 설치

[TOC]

#### 2.1리눅스 설치

##### 2.1.1 리눅스 설치의 개요

운영체제의 사용환경이 텍스트 기반에서 gui 환경으로 전환되고 당양한 용도의 리눅스가 등장하면서 고사양을 요구하는 리눅스도 등장 사용하는 목적에 따라 선택하고 배포되는 리눅스마다 지원되는 아키텍처가 다르기 때문에 시스템에서 사용하는 CPU를 지원하는 리눅스를 선택한다.

##### 2.1.2 리눅스 설치를 위한 하드웨어 정보 파악

cpu, 메모리 ,하드 디스크 등에 대한 정확한 정보는 리눅스 설치와 운영 및 관리에 꼭 필요한 정보이다.

- CPU 
  - 인텔사 :x86, x86_64(Xeon),IA-64(Itanium)
  - 32비트 64비트 cpu 여부에 따라 기본적으로 지원되는 메모리의 양이 다름
  - i7-7500U CPU@ 2.70GHz 2.90GHz / x64 기반 프로세서
- 메모리(RAM) : 하드 디스크 일부 공간을 램처럼 사용하는 스왑파티션 설정과 관련있기때문에 확인 필요
  - 설치된  메모리 : 8.00GB
- 하드 디스크 드라이브
  - 하드디스크 인터페이스에 따라 파일 명이 달라짐.
    - ide :/dev/hda ,/dev/hdb등
    - SCSI,USB메모리,SSD등:/dev/sda,/dev/sdb 등
  - 내장형 SSD :samsung mzvlw256hehp-000
- 모니터와 비디오 어댑터
- 네트워크 인터페이스
  - 네트워크 환경 기반으로 네트워크 인터페이스 설정은 필수
  - 주로 이더넷 사용: 제조사 상관없이 지원
  - 네트워크 설정을 위해서는 IP주소, 넷마스크,게이트웨이 주소, DNS 서버의 IP주소 등을 알아야한다
- 키보드 및 마우스
- CD-ROM 및 DVD-ROM
- 기타 하드웨어

##### 2.1.3 리눅스 설치하기

- VirtualBox 설치 : 리눅스 가상환경 만들기
  - https://www.virtualbox.org/
  - Downloads / Windows hosts
  - 이름에 CentOS-7 로 지정하면 자동으로  종류와버전이 세팅된다. Linux /Red Hat (64-bit)
  - 4096MB (2GB)로 메모리 할당
  - 하드디스크 - '지금 새 가상 하드디스크 만들기' 선택
  - 하드디스크 파일 종류 -VDL선택
  - 물리적 하드드라이브에 저장 - 동적할당
  - 파일 위치및 크기- 30.92GB
  - 설정 / 저장소 / 광학 드라이브 /파일 선택 : CentOS-7-x86_64-DVD-1810.iso

#### 2.2 파티션

##### 2.2.1 파티션의 개요

파티션 분할: 하드디스크의 영역 설정, 하나의 물리적 디스크를 여러개의 논리적인 디스크로 분할 하는 것, 분할 된 파티션은 하나의 독립적인 디스크로 간주되어 블록과 파일 시스템 구성 등을 독자적으로 할 수 있으며 , 다양한 정책들도 독립적으로 설정 할 수 있다

- 파티션 분할의 장점
  - 여러개의 운영체제 사용 가능
  - 파티션 단위의 다양한 정책설정 가능(사용자및 그룹쿼터 설정, 보안설정,백업설정, 파일 시스템 점검 설정 )
  - 디스크 효율성 극대화 - 사용자가 원하는 파일 시스템 구성 가능, 블록크기 설정 가능
  - 안정성을 높일수 있음 - 파티션 단위 데이터 복구
  - 자료 이전및 관리,백업 용이
  - 부팅이 빨라짐, 파일 시스템 점검 시간 단축
  - 특정 영역 데이터 증가에 따른 시스템 및 프로세스 중단 방지

##### 2.2.2 디스크와 장치명

|     연결위치     |  파일명  |
| :--------------: | :------: |
|  Primary Master  | /dev/hda |
|  Primary Slave   | /dev/hdb |
| Secondary Master | /dev/hdc |
| Secondary Slave  | /dev/hdd |

별도 : SCSI/SAT-A/SSD/USB메모리등 -  /dev/sd ***x***

##### 2.2.3 파티션의 종류

|    파티션 송류    | 특징                                                         |
| :---------------: | :----------------------------------------------------------- |
| Primary Partition | - 부팅 가능 파티션,디스크에 하나 이상 존재해야함<br />-  하나의 물리적 디스크에 총 4개까지 생성, 파티션 번호로 1~4번이 할당<br />- Extend Partition을 사용할 경우 실질적으로 사용 가능한 Primary Partition은 3개가 됨 |
| Extend Partition  | - 하나의 물리적 디스크에 1개만 생성 가능<br />-  Primary 영역 내에 대체해서 사용하는 것임, 파티션 번호도 1~4로 할당<br />- 자료를 저장하기 위한 파티션 x, Logical Partition을 사용하기위해 선언되는 파티션 |
| Logical Partition | - Extend Partition 안에 선언됨<br />- 생성되는 갯수 제한 x ,12개 이상 생성은 권장하지 않음<br />- Logical Partition은 5번 이후에 번호가 붙여짐 |

##### 2.2.4 파티션과 장치명

- 분할된 파티션은 디스크 장치 파일명 뒤에 숫자가 붙여져 관리된다.
- 일반 IDE 파티션 생성 -  /dev/hda1의 형식 
- SCSI,S-ATA,SSD,USB메모리등 파티션 생성 - /dev/sda1,/dev/sdb1의 형식
- /dev/sda1
  - sd: [디스크 방식] 즉 S-ATA,SCSI방식 디스크,SSD,USB메모리를 뜻함(hd면 IDE or ATA)
  - a: [디스크의 우선순위] 알파벳 a부터 시작하여 표기(a~d)
  - 1: [파티션 번호] 1~4 는 Primary or Extend Partition , 5~ 은 Logical Partition

##### 2.2.5 파티션 분할 

- 리눅스에서는 최소한 /와 swao 파티션을 분할 해야한다.
- root 권한으로 fdisk /dev/[장치명:sda,hda ... ] 
- 파티션 분할이 필요한 영역과 디렉터리
  - / : 설치의 기본이 되는 영역 , 파티션 미분할 시 모든 디렉터리와 프로그램들이 이곳에 설치된다.[최소 파티션 크기 : 250MB]
  - swap : 시스템 자료를 처리할 때 RAM이 부족할 경우 사용되는 스왑 영역,  보통 RAM용량의 2배를 스왑 영역으로 지정
  - /boot : 부팅과 연결된 파일, 부트  로더인 GRUB관련파일, 시스템의 커널 등이 들어있는 디렉터리, /boot를 하드디스크의 앞부분에 할당하면 약간 부팅 속도가 빨라지는 장점이 있으나 체감 속도가 빠르지않아 미설정인 경우가 많다[최소 파티션 크기 : 250MB]
  - /usr : X-Window 를 비롯 리눅스 으용프로그램의 대부분이 이영역에 설치, 최근 레드햇에서는 iSCSI에서 동작 이상과 부트 프로세스의 복잡성등으로 별도 파티션으로 분할 하지 않도록 권장 [최소 파티션 크기 : 250MB]
  - /var : 시스템의 로그파일, 프린터 spool, 메일등이 저장되는 디렉터리, 최근 yum을 사용하는 경우 다운로드한 업데이트 패키지들이 임시로 저장되는 용도로 사용, 충분한 크기로 여유있게 설정해야함[최소 파티션 크기 : 384MB]
  - /home : 계정 사용자의 자료가 저장되는 디렉터리, 다수의 사용자 기반의 서버로 운영되는 경우 할당 필요[최소 파티션 크기 : 100MB]
  - /tmp : 각종 프로그램이나 소켓 파일, 프로세스 작업을 할 때 임시로 생성되는 파일을 저장하는 공간, 모든 접근자가 권한을 가지므로 보안상의 취약점이 있고 보한 강화를 위해 파티션 분할이 요구된다. [최소 파티션 크기 : 50MB]

##### 2.2.6 파티션 확인

- 명령어 : root 권한으로 fdisk -l
- fdisk로 파티션 추가후 재부팅 필요
- 실제 리눅스 상에서 반영되는 파티션 정보 : /proc/partitions 에서 확인

#### 2.3 시스템의 시작과 종료

##### 2.3.1 부트매니저와 GRUB

- 부트매니저 :부팅을 도와주는 역할(부트로더)
- 대표적인 부트 매니저 프로그램 : LILO(Linux Loader)dhk GRUB(Grand Unified BootLoader)
- 특정 파일 시스템에 구애받지 않고 플로피 디스크와 하드 디스크를 이용한 부팅을 지원
-  GRUB
  - GNU 프로젝트에서 만든 부트로더 
  - 다양한 파일 시스템 지원
  - 부팅시 커널 인자를 조정 동적인 부팅 지원
  - 메뉴인터페이스 ,Bash 명령행 인터페이스 제공
  - 그래픽 메뉴 ,배경 그림 삽입 가능
  - GRUB부팅 모드
    - 편집 모드 : 
      - GRUB 목록에서 [e]키 :설정창 오픈
      - 커서로 선택 
      - [ctrl]+[x] : 부팅 시작 
      - [ctrl]+[c] : 관련 설정 직접 입력
      - [ESC] : 초기 GRUB 메뉴로 돌아감
    - 명령 프롬프트 모드 : 
      - GRUB 목록에서 [c]키 : 모드 진입
      - Bash Shell과 유사
      - [TAB] : 명령행 자동완성
      - [ESC] : 취소
      - 부팅 : 순차적 입력후 boot 입력
    - GRUB 환경 설정 파일
      - /boot/grub2/grub.cfg
      - 셀 스크립트 형태
      - 환경 설정파일 변경 후 grub2-mkconfig 명령 실행 필요
      - GRUB 운영과 관련된 주요설정들은 /etc/default/grub파일이다(명령어: cat /etc/default/grub) 
        - GRUB_TIMEOUT=5 - GRUB 부트 화면에서 대기하는 시간(부팅대기시간)
        - GRUB_DISTRIBUTOR =... - GRUB부트 화면에서 각 엔트리 앞에 보여질 리눅스 배포판 이름을 추출할때 사용
        - GRUB_DEFAULT=saved - 부트화면에 제시된 목록 중에 기본적으로 부팅할 모드 선택(정수값) 'saved'는 기본 메뉴 목록에 'GRUB_SAFEDEFAULT' or 'grub-set-defualt'에 의해 저장된다.
        - GRUB_DISABLE_SUBMENU=true - grub-mkconfig 에서 버전 번호가 가장 높은 커널에 대해 최상위 메뉴 항목으로 생성 그외 다른 커널 및 복구모드는 하위 메뉴로 생성됨 true로 설정하면 하위 메뉴를 생성하지 않도록 설정하는 것
        - GRUB_TERMINAL_OUTPUT='console' - GRUB이 출력되는 터미널 장치를 설정하는 항목, 기본이 'console'
        - GRUB_CMDLINE_LINUX ='crashkernel= auto rhgb quiet' -  커널 인자값 지정 항목
        - GRUB_DISABLE_RECOVERTY='true' - 부트 메뉴 엔트리에 복구 모드를 표시할것인지 지정,'true' 일경우 표시 x
      - GRUB의 활용
        - root 패스워드를 잃어버렸을 경우 - 응급 복구 모드로 접근
          - [e] 
          - 커널 인자값으로 커서 이동 
          - 'ro rhgb quite LANG=ko_KR.UTF-8' 을 지우고 'rw init=/bin/sh' 입력
          - [ctrl]+[x] : 부팅
          - 패스워드 변경
        - GRUB 패스워드 설정
          - vi /etc.grub.d/00_header : 파일 오픈
          - 파일수정 마지막 줄에 i나 a로 insert
            - cast <<EOF
            - set superusers='posein'
            - password posein 1234
            - EOF
          - [esc] -> : ->wq ->[enter] - 저장
          - tail -4 /etc/grub.d/00_header :변경 사항 확인
          - grub2-mkconfig -o /boot/grub2/grub.ctg : 명령실행
          - 재부팅 후 편집 모드 [e] 

##### 2.3.2 부팅

##### 2.3.3 systemd

##### 2.3.4 시스템 종료