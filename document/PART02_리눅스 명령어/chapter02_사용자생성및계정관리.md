# chapter02 사용자 생성 및 계정관리

[TOC]

#### 2.1 사용자 관리

##### 2.1.1 사용자(User)의 개요

- 사용자(User)분류 

  - 정수형 숫자 형태의 UID(User Identity)로 관리  

  - root -  Super User or Privileged User : 모든 권한을 가짐 (UID 0)
  - 일반 - Normal user or Unprivileged user : 제한적 권한을 가짐 ( UID 1~ :: 레드헷 계열은 일반적으로 1000~) , 로그인 가능 계정, 시스템 계정

- 시스템 계정

  - 시스템의 필요에 의해 생성된 계정

##### 2.1.2 사용자 생성 명령어

- 사용자 계정 생성: useradd

  계정: 시스템에 ID PW 생성 사용권을 부여하는 것, 이때 사용자의 ID를 생성하는 명령이 useradd, root 권한자가 root 이외 사용자를 생성할때도 사용하는 명령어

  - 사용법 :  useradd [option] 사용자 계정이름
  - 전체 목록에서 user 목록 찾기 : cat /etc/passwd or cut -f1 -d: /etc/passwd
  - bash 목록에서 생성된 user  확인 명령어 :  grep /bin/bash /etc/passwd | cut -f1 -d:
  
- 사용자 암호 부여: passwd

  - useradd로 계정 생성 후 암호를 지정하지 않으면 로그인 x 
  - root만 다른 사용자의 암호를 변경할 수 있음

- 사용자 전환: su

  - substitute user: 대리 유저의 약자

  - 옵션

    | 옵션 | 의미                                                         |
    | ---- | ------------------------------------------------------------ |
    | -c   | 사용자를 전환하지 않고 다른 사용자의 권한으로 명령을 일시적으로 수행 |

##### 2.1.3 사용자 관련 파일

- 리눅스는 대부분의 정보를 텍스트 파일에 저장해서 관리한다.

- /etc/passwd

  - 로그인하여 자원을 이용할 수 있는 사용자의 목록을 저장하고 있는 파일

  - 콜론(:)을 구분자로 ID, 개인 홈 디렉터리 등 7개의 기본 정보를 담고 있다.

  - 항목 설명

    | 필드            | 설명                                                         |
    | --------------- | ------------------------------------------------------------ |
    | posein(=jian)   | 사용자명으로 일명 ID                                         |
    | x               | 사용자의 패스워드가 기록되는 부분, 현재 리눅스 배포판은 이 필드에 기록되는 패스워드를 암호화하여 /etc/shadow에서 별도 관리함 |
    | 1000            | UserID로 리눅스에서 사용자를 숫자값으로 관리                 |
    | 1000            | GroupID로 사용자가 속한 그룹의 숫자값                        |
    | System Engineer | 사용자에 대한 추가적인 정보가 기록됨                         |
    | /home/posein    | 사용자의 작업 디렉터리인 홈 디렉터리를 나타냄                |
    | /bin/bash       | 로그인시 사용하는 셸                                         |

- /etc/shadow

  - /etc/passwd의 두번째 필드인 패스워드 부분을 암호화해 관리, 총 9개의 필드로 구성, 패스워드 만기일, 계정 만기일 등을 설정할 수 있다.

  - 확인 명령어 

    ```
    $ grep jian /etc/shadow
    ```

  - 항목 설명

    | 필드              | 설명                                                         |
    | ----------------- | ------------------------------------------------------------ |
    | posein(=jian)     | 사용자명으로 일명 ID                                         |
    | $6$..             | 암호화된 사용자의 패스워드가 기록되어있는 곳                 |
    | 15917             | 가장 최근에 패스워드를 바꾼 날로 1970년 1월 1일 부터 계산한 날수 |
    | 0                 | 패스워드를 바꾼후 최소로 사용해야 되는 날짜수로 다른 패스워드로 변경 가능하기까지의 유예기간,0이면 언제라도 패스워드 변경 가능 |
    | 99999             | 현재 사용중인 패스워드의 최대 사용가능 기간                  |
    | 7                 | 패스워드 사용기간이 만료되기 전에 사용자에게 바꿀 것을 경고하는 기간 |
    | 3                 | 패스워드 사용기한이 만료된 뒤 실제 계정 사용이 불가능 하기까지의 기간 |
    | 16070             | 계정 사용이 불가능하게 된날                                  |
    | 공백 (9번째 필드) | 다른 기능을 사용하기 위해 남겨둔 예약된 공간                 |

- /etc/default/useradd

  - 병도 옵션없이 useradd 사용자명 으로 계정 생성시 기본적으로 적용되는 설정이 들어있다.

  - cat 으로 확인 가능 

  - 항목설명

    | 항목                  | 설명                                                         |
    | --------------------- | ------------------------------------------------------------ |
    | GROUP=100             | 사용자 생성시 기본적으로 속하게 되는 그룹을 지정한 부분 GID가 100인 users라는 그룹에 속하게 된다.그러나 레드햇 리눅스는 이값 적용 x, 사용자 아이디와 동일한 그룹을 생성한 뒤 그 그룹에 사용자 혼자 속함 |
    | HOME=/home            | 홈 디렉터리 위치                                             |
    | INACTIVE=-1           | 패스워드 사용 기한이 지난후 실제로 계정의 로그인을 막는 유예기간 설정 , -1은 설정 안함 |
    | EXPIRE=               | 계정 유효기간 지정하는 부분 'yyyy-mm-dd'                     |
    | SHELL=/bin/bash       | 사용자 생성시 할당되는 셸을 의미                             |
    | SKEL=/etc/skel        | 사용자 생성 시에 제공되는 파일 및 디렉터리가 들어있는 디레거리를 의미 |
    | CREATE_MAIL_SPOOL=yes | 사용자 생성 시에 메일 파일을 생성할 것인지 지정, 지정하면 /var/spool/mail/사용자명으로 메일 관련 파일이 생성된다 |

- useradd 명령을 /etc/default/useradd 파일 관리

  - 사용법

    ```
    # useradd -D option
    ```

  - 주요 옵션

    | 옵션 | 의미                                                         |
    | ---- | ------------------------------------------------------------ |
    | -D   | 사용자 추가시 기본적으로 반영되는 정보파일인 /etc/default/useraddd의 내용을 출력한다 |
    | -g   | 기본 그룹 지정                                               |
    | -b   | 사용자 홈 디렉터리의 상위 디렉터리를 지정                    |
    | -f   | 패스워드 유효기간이 만료된 후 계정 유예기간 설정(단위:하루)  |
    | -e   | 사용자의 계정이 만료일을 지정하는 옵션                       |
    | -s   | 사용자의 기본 셸을 지정할 때 사용하는 옵션                   |

##### 2.1.4 사용자 계정 관리 및 삭제

- 사용자 계정 관리: usermod

  - 사용자의 셸, 홈 디렉터리, 그룹 UID,GID 등을 변경하는 명령어

  - 사용법

    ```
    # usermod [옵션] 사용자 계정
    ```

  - 주요옵션

    | 옵션 | 의미                                                         |
    | ---- | ------------------------------------------------------------ |
    | -d   | 사용자의 홈 디렉터리 변경, 변경할 디렉터리 미리 생성 되어있어야함 |
    | -m   | 사용자의 홈 디렉터리 변경시 기존에 사용하던 파일 및 디렉터리를 옮겨주는 옵션 -d와 함께 쓰인다 |
    | -g   | 사용자 그룹변경(--gid)                                       |
    | -s   | 사용자의 셜변경(--shell)                                     |
    | -u   | 사용자의 UID 값 변경(--uid)                                  |
    | -e   | 계정 만기일 변경(--expiredate)                               |
    | -f   | 패스워드 만기일이 지난 후 패스워드에 락을 설정할 유예기간 지정(--incative) |
    | -c   | 사용자의 간단한 정보를 입력하거나 변경(--comment)            |
    | -G   | 추가로 다른 그룹에 속하게 할때쓰임(--groups)                 |
    | -a   | -G 옵션과 같이 사용하는 옵션 기존의 2차 그룹 이외 추가로 2차 그룹지정(--append) |
    | -p   | /etc/shadow의 두번째 필드인 암호화된 패스워드 값을 변경할때쓰임, 암호화된 값으로 지정해야함(--password) |
    | -l   | 사용자 아이디 변경(--login)                                  |
    | -L   | 사용자으 패스워드에 락을 걸어 로그인 막기(--look)            |
    | -U   | 사용자의 패스워드에 걸린 락 풀기(--unlook)                   |

- 사용자 계정 삭제: usedel

  - 사용법 

    ```
    # userdel [option] 사용자 계정
    ```

  - 주요옵션

    | 옵션 | 의미                                                      |
    | ---- | --------------------------------------------------------- |
    | -r   | 사용자의 홈 디렉터리 및 메일 관련 파일까지 제거(--remove) |

##### 2.1.5 사용자 패스워드 관리

#### 2.2 그룹관리

##### 2.2.1 그룹의 개요

##### 2.2.2 그룹(Group)의 조회

##### 2.2.3 그룹 관리 명령어

#### 2.3 사용자 조회 및 기타 명령어

##### 2.3.1 사용자 조회 명령어

##### 2.3.2 사용자 간 메시지 전송 명령어

##### 2.3.3 기타명령어



